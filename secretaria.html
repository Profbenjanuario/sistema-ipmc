<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel da Secretaria - Sistema IPMC</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f5f6fa;
            color: #333;
        }

        .dashboard-container {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .dashboard-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-left h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .dashboard-content {
            display: flex;
            flex: 1;
        }

        .sidebar {
            width: 250px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 2rem 0;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: block;
            padding: 1rem 2rem;
            color: #333;
            text-decoration: none;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .nav-link:hover,
        .nav-link.active {
            background: #f8f9fa;
            border-left-color: #667eea;
            color: #667eea;
        }

        .main-content {
            flex: 1;
            padding: 2rem;
            background: #f8f9fa;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card h3 {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }

        .user-form {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .curso-card,
        .turma-card {
            background: white;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s;
        }

        .curso-card:hover,
        .turma-card:hover {
            border-color: #667eea;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .curso-header,
        .turma-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .curso-header h3,
        .turma-header h3 {
            margin: 0;
            color: #333;
        }

        .curso-codigo {
            background: #667eea;
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-badge.pendente {
            background: #fff3cd;
            color: #856404;
        }

        .status-badge.validada {
            background: #d4edda;
            color: #155724;
        }

        .status-badge.recusada {
            background: #f8d7da;
            color: #721c24;
        }

        .curso-info p,
        .turma-info p {
            margin: 0.5rem 0;
            color: #666;
        }

        .curso-disciplinas {
            margin: 1rem 0;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .curso-disciplinas h4 {
            margin-bottom: 0.5rem;
            color: #333;
        }

        .curso-disciplinas ul {
            list-style: none;
            padding-left: 0;
        }

        .curso-disciplinas li {
            padding: 0.25rem 0;
            color: #666;
        }

        .curso-actions,
        .turma-actions {
            margin-top: 1rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .action-btn.primary {
            background: #667eea;
            color: white;
        }

        .action-btn.success {
            background: #28a745;
            color: white;
        }

        .action-btn.danger {
            background: #dc3545;
            color: white;
        }

        .action-btn.warning {
            background: #ffc107;
            color: #333;
        }

        .action-btn:hover {
            transform: translateY(-1px);
        }

        .disciplinas-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .disciplina-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .disciplina-item input {
            flex: 1;
        }

        .remove-disciplina {
            background: #dc3545;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1.2rem;
        }

        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }

        .activities-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1.5rem;
        }

        .activity-item {
            padding: 1rem;
            border-bottom: 1px solid #e1e5e9;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-info h4 {
            margin-bottom: 0.25rem;
            color: #333;
        }

        .activity-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .filter-section {
            margin-bottom: 1.5rem;
        }

        .filter-section select {
            padding: 0.5rem;
            border: 2px solid #e1e5e9;
            border-radius: 5px;
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quick-action-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .quick-action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .quick-action-card i {
            font-size: 2rem;
            color: #667eea;
            margin-bottom: 1rem;
        }

        .search-box {
            margin-bottom: 1.5rem;
        }

        .search-box input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 1rem;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .export-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .close-modal {
            float: right;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close-modal:hover {
            color: #333;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <header class="dashboard-header">
            <div class="header-left">
                <h1>Sistema IPMC - Secretaria</h1>
            </div>
            <div class="header-right">
                <span id="userWelcome">Bem-vindo(a), Secretaria</span>
                <button onclick="logout()" class="logout-btn">Sair</button>
            </div>
        </header>

        <div class="dashboard-content">
            <nav class="sidebar">
                <ul>
                    <li><a href="#dashboard" class="nav-link active" data-section="dashboard">Dashboard</a></li>
                    <li><a href="#criar-curso" class="nav-link" data-section="criar-curso">Criar Curso</a></li>
                    <li><a href="#criar-turma" class="nav-link" data-section="criar-turma">Criar Turma</a></li>
                    <li><a href="#matricular-estudante" class="nav-link" data-section="matricular-estudante">Matricular Estudante</a></li>
                    <li><a href="#gerenciar-cursos" class="nav-link" data-section="gerenciar-cursos">Gerir Cursos</a></li>
                    <li><a href="#gerenciar-turmas" class="nav-link" data-section="gerenciar-turmas">Gerir Turmas</a></li>
                    <li><a href="#gestao-estudantes" class="nav-link" data-section="gestao-estudantes">Gest√£o de Estudantes</a></li>
                    <li><a href="#relatorios" class="nav-link" data-section="relatorios">Relat√≥rios</a></li>
                </ul>
            </nav>

            <main class="main-content">
                <!-- Dashboard Section -->
                <section id="dashboard" class="content-section active">
                    <h2>Dashboard da Secretaria</h2>
                    
                    <!-- A√ß√µes R√°pidas -->
                    <div class="quick-actions">
                        <div class="quick-action-card" onclick="secretariaSystem.showSection('criar-curso')">
                            <div>üìö</div>
                            <h3>Criar Curso</h3>
                            <p>Registar novo curso</p>
                        </div>
                        <div class="quick-action-card" onclick="secretariaSystem.showSection('criar-turma')">
                            <div>üë•</div>
                            <h3>Criar Turma</h3>
                            <p>Nova turma para curso</p>
                        </div>
                        <div class="quick-action-card" onclick="secretariaSystem.showSection('matricular-estudante')">
                            <div>üéì</div>
                            <h3>Matricular Estudante</h3>
                            <p>Novo estudante</p>
                        </div>
                        <div class="quick-action-card" onclick="secretariaSystem.gerarRelatorioRapido()">
                            <div>üìä</div>
                            <h3>Relat√≥rio R√°pido</h3>
                            <p>Estat√≠sticas do dia</p>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <h3>Cursos Activos</h3>
                            <span id="cursosAtivos" class="stat-number">0</span>
                        </div>
                        <div class="stat-card">
                            <h3>Turmas Criadas</h3>
                            <span id="turmasCriadas" class="stat-number">0</span>
                        </div>
                        <div class="stat-card">
                            <h3>Turmas Pendentes</h3>
                            <span id="turmasPendentes" class="stat-number">0</span>
                        </div>
                        <div class="stat-card">
                            <h3>Estudantes Matriculados</h3>
                            <span id="estudantesMatriculados" class="stat-number">0</span>
                        </div>
                    </div>

                    <div class="recent-activities">
                        <h3>Turmas Aguardando Valida√ß√£o</h3>
                        <div id="turmasAguardandoValidacao" class="activities-list">
                            <!-- Turmas pendentes ser√£o carregadas aqui -->
                        </div>
                    </div>

                    <div class="recent-activities">
                        <h3>√öltimas Matr√≠culas</h3>
                        <div id="ultimasMatriculas" class="activities-list">
                            <!-- √öltimas matr√≠culas ser√£o carregadas aqui -->
                        </div>
                    </div>
                </section>

                <!-- Criar Curso Section -->
                <section id="criar-curso" class="content-section">
                    <h2>Criar Novo Curso</h2>
                    <div class="user-form">
                        <form id="formCurso">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="cursoNome">Nome do Curso *</label>
                                    <input type="text" id="cursoNome" name="nome" required placeholder="Ex: T√©cnico de Inform√°tica">
                                </div>
                                <div class="form-group">
                                    <label for="cursoCodigo">C√≥digo do Curso *</label>
                                    <input type="text" id="cursoCodigo" name="codigo" required placeholder="Ex: TINF-2024">
                                </div>
                                <div class="form-group">
                                    <label for="cursoDuracao">Dura√ß√£o (meses) *</label>
                                    <input type="number" id="cursoDuracao" name="duracao" min="1" max="48" required>
                                </div>
                                <div class="form-group">
                                    <label for="cursoArea">√Årea *</label>
                                    <input type="text" id="cursoArea" name="area" required placeholder="Ex: Tecnologias de Informa√ß√£o">
                                </div>
                                <div class="form-group">
                                    <label for="cursoTipo">Tipo *</label>
                                    <select id="cursoTipo" name="tipo" required>
                                        <option value="">Selecione o tipo</option>
                                        <option value="T√©cnico">T√©cnico</option>
                                        <option value="Profissional">Profissional</option>
                                        <option value="Superior">Superior</option>
                                        <option value="Curta Dura√ß√£o">Curta Dura√ß√£o</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="cursoPreco">Pre√ßo Mensal (KZ)</label>
                                    <input type="number" id="cursoPreco" name="preco" min="0" placeholder="Valor da mensalidade">
                                </div>
                                <div class="form-group">
                                    <label for="cursoVagas">Vagas Totais</label>
                                    <input type="number" id="cursoVagas" name="vagasTotais" min="1" placeholder="N√∫mero total de vagas">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="cursoDescricao">Descri√ß√£o do Curso</label>
                                <textarea id="cursoDescricao" name="descricao" rows="3" placeholder="Descri√ß√£o detalhada do curso..."></textarea>
                            </div>

                            <div class="form-group">
                                <label for="cursoRequisitos">Requisitos de Ingresso</label>
                                <textarea id="cursoRequisitos" name="requisitos" rows="2" placeholder="Requisitos para ingressar no curso..."></textarea>
                            </div>

                            <div class="disciplinas-section">
                                <h4>Disciplinas do Curso *</h4>
                                <div id="disciplinasContainer">
                                    <div class="disciplina-item">
                                        <input type="text" name="disciplinas[]" placeholder="Nome da disciplina" required>
                                        <input type="number" name="cargasHorarias[]" placeholder="Carga hor√°ria (horas)" min="1" required>
                                        <select name="tiposDisciplina[]" required>
                                            <option value="Te√≥rica">Te√≥rica</option>
                                            <option value="Pr√°tica">Pr√°tica</option>
                                            <option value="Te√≥rico-Pr√°tica">Te√≥rico-Pr√°tica</option>
                                        </select>
                                        <button type="button" class="remove-disciplina" onclick="removerDisciplina(this)">√ó</button>
                                    </div>
                                </div>
                                <button type="button" class="add-btn" onclick="adicionarDisciplina()">+ Adicionar Disciplina</button>
                            </div>

                            <button type="submit" class="submit-btn">Criar Curso</button>
                        </form>
                    </div>
                </section>

                <!-- Criar Turma Section -->
                <section id="criar-turma" class="content-section">
                    <h2>Criar Nova Turma</h2>
                    <div class="user-form">
                        <form id="formTurma">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="turmaNome">Nome da Turma *</label>
                                    <input type="text" id="turmaNome" name="nome" required placeholder="Ex: TINF-2024-A">
                                </div>
                                <div class="form-group">
                                    <label for="turmaCurso">Curso *</label>
                                    <select id="turmaCurso" name="cursoId" required>
                                        <option value="">Selecione o curso</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="turmaSala">Sala *</label>
                                    <input type="text" id="turmaSala" name="sala" required placeholder="Ex: Sala 101">
                                </div>
                                <div class="form-group">
                                    <label for="turmaPeriodo">Per√≠odo *</label>
                                    <select id="turmaPeriodo" name="periodo" required>
                                        <option value="Manh√£">Manh√£</option>
                                        <option value="Tarde">Tarde</option>
                                        <option value="Noite">Noite</option>
                                        <option value="Integral">Integral</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="turmaVagas">Vagas *</label>
                                    <input type="number" id="turmaVagas" name="vagas" min="1" max="50" required>
                                </div>
                                <div class="form-group">
                                    <label for="turmaAnoLetivo">Ano Letivo *</label>
                                    <input type="number" id="turmaAnoLetivo" name="anoLetivo" min="2024" max="2030" value="2024" required>
                                </div>
                                <div class="form-group">
                                    <label for="turmaDataInicio">Data de In√≠cio *</label>
                                    <input type="date" id="turmaDataInicio" name="dataInicio" required>
                                </div>
                                <div class="form-group">
                                    <label for="turmaDataFim">Data de T√©rmino *</label>
                                    <input type="date" id="turmaDataFim" name="dataFim" required>
                                </div>
                                <div class="form-group">
                                    <label for="turmaTurno">Turno</label>
                                    <select id="turmaTurno" name="turno">
                                        <option value="Regular">Regular</option>
                                        <option value="P√≥s-Laboral">P√≥s-Laboral</option>
                                        <option value="Fim-de-Semana">Fim-de-Semana</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="turmaObservacoes">Observa√ß√µes</label>
                                <textarea id="turmaObservacoes" name="observacoes" rows="2" placeholder="Observa√ß√µes sobre a turma..."></textarea>
                            </div>

                            <button type="submit" class="submit-btn">Criar Turma</button>
                        </form>
                    </div>
                </section>

                <!-- Matricular Estudante Section -->
                <section id="matricular-estudante" class="content-section">
                    <h2>Matricular Estudante</h2>
                    <div class="user-form">
                        <form id="formEstudante">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="estudanteUsername">Username *</label>
                                    <input type="text" id="estudanteUsername" name="username" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudantePassword">Password *</label>
                                    <input type="password" id="estudantePassword" name="password" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteNome">Nome Completo *</label>
                                    <input type="text" id="estudanteNome" name="nome" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteDataNascimento">Data de Nascimento *</label>
                                    <input type="date" id="estudanteDataNascimento" name="dataNascimento" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteGenero">G√™nero *</label>
                                    <select id="estudanteGenero" name="genero" required>
                                        <option value="Masculino">Masculino</option>
                                        <option value="Feminino">Feminino</option>
                                        <option value="Outro">Outro</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteBilhete">Bilhete de Identidade *</label>
                                    <input type="text" id="estudanteBilhete" name="bilheteIdentidade" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteContacto">Contacto *</label>
                                    <input type="tel" id="estudanteContacto" name="contacto" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteEmail">Email *</label>
                                    <input type="email" id="estudanteEmail" name="email" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteResidencia">Resid√™ncia *</label>
                                    <input type="text" id="estudanteResidencia" name="residencia" required>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteTurma">Turma *</label>
                                    <select id="estudanteTurma" name="turmaId" required>
                                        <option value="">Selecione a turma</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="estudanteEncEducacao">Encarregado de Educa√ß√£o</label>
                                    <input type="text" id="estudanteEncEducacao" name="encarregadoEducacao" placeholder="Nome do encarregado">
                                </div>
                                <div class="form-group">
                                    <label for="estudanteContactoEnc">Contacto do Encarregado</label>
                                    <input type="tel" id="estudanteContactoEnc" name="contactoEncarregado" placeholder="Contacto do encarregado">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="estudanteObservacoes">Observa√ß√µes</label>
                                <textarea id="estudanteObservacoes" name="observacoes" rows="2" placeholder="Observa√ß√µes sobre o estudante..."></textarea>
                            </div>

                            <button type="submit" class="submit-btn">Matricular Estudante</button>
                        </form>
                    </div>
                </section>

                <!-- Gerir Cursos Section -->
                <section id="gerenciar-cursos" class="content-section">
                    <h2>Gerir Cursos</h2>
                    <div class="search-box">
                        <input type="text" id="searchCursos" placeholder="Pesquisar cursos..." onkeyup="secretariaSystem.filtrarCursos()">
                    </div>
                    <button class="export-btn" onclick="secretariaSystem.exportarCursos()">üì• Exportar Lista de Cursos</button>
                    <div id="cursosList" class="cards-grid">
                        <!-- Cursos ser√£o carregados aqui -->
                    </div>
                </section>

                <!-- Gerir Turmas Section -->
                <section id="gerenciar-turmas" class="content-section">
                    <h2>Gerir Turmas</h2>
                    <div class="filter-section">
                        <select id="filtroStatus" onchange="secretariaSystem.filtrarTurmas()">
                            <option value="todas">Todas as Turmas</option>
                            <option value="pendente">Pendentes</option>
                            <option value="validada">Validadas</option>
                            <option value="recusada">Recusadas</option>
                        </select>
                        <select id="filtroCurso" onchange="secretariaSystem.filtrarTurmas()">
                            <option value="todos">Todos os Cursos</option>
                        </select>
                    </div>
                    <button class="export-btn" onclick="secretariaSystem.exportarTurmas()">üì• Exportar Lista de Turmas</button>
                    <div id="turmasList" class="cards-grid">
                        <!-- Turmas ser√£o carregadas aqui -->
                    </div>
                </section>

                <!-- Gest√£o de Estudantes Section -->
                <section id="gestao-estudantes" class="content-section">
                    <h2>Gest√£o de Estudantes</h2>
                    <div class="search-box">
                        <input type="text" id="searchEstudantes" placeholder="Pesquisar estudantes..." onkeyup="secretariaSystem.filtrarEstudantes()">
                    </div>
                    <button class="export-btn" onclick="secretariaSystem.exportarEstudantes()">üì• Exportar Lista de Estudantes</button>
                    <div id="estudantesList" class="cards-grid">
                        <!-- Estudantes ser√£o carregados aqui -->
                    </div>
                </section>

                <!-- Relat√≥rios Section -->
                <section id="relatorios" class="content-section">
                    <h2>Relat√≥rios</h2>
                    <div class="reports-grid">
                        <div class="report-card">
                            <h4>Relat√≥rio de Cursos</h4>
                            <p>Lista completa de todos os cursos</p>
                            <button onclick="secretariaSystem.gerarRelatorioCursos()" class="action-btn primary">Gerar Relat√≥rio</button>
                        </div>
                        <div class="report-card">
                            <h4>Relat√≥rio de Turmas</h4>
                            <p>Turmas por status e curso</p>
                            <button onclick="secretariaSystem.gerarRelatorioTurmas()" class="action-btn primary">Gerar Relat√≥rio</button>
                        </div>
                        <div class="report-card">
                            <h4>Relat√≥rio de Estudantes</h4>
                            <p>Estudantes por turma e curso</p>
                            <button onclick="secretariaSystem.gerarRelatorioEstudantes()" class="action-btn primary">Gerar Relat√≥rio</button>
                        </div>
                        <div class="report-card">
                            <h4>Relat√≥rio de Matr√≠culas</h4>
                            <p>Estat√≠sticas de matr√≠culas</p>
                            <button onclick="secretariaSystem.gerarRelatorioMatriculas()" class="action-btn primary">Gerar Relat√≥rio</button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Modal para detalhes do estudante -->
    <div id="modalEstudante" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="fecharModalEstudante()">&times;</span>
            <h3>Detalhes do Estudante</h3>
            <div id="detalhesEstudante">
                <!-- Detalhes ser√£o carregados aqui -->
            </div>
        </div>
    </div>

    <script>
        // Fun√ß√µes globais para disciplinas
        function adicionarDisciplina() {
            const container = document.getElementById('disciplinasContainer');
            const newDisciplina = document.createElement('div');
            newDisciplina.className = 'disciplina-item';
            newDisciplina.innerHTML = `
                <input type="text" name="disciplinas[]" placeholder="Nome da disciplina" required>
                <input type="number" name="cargasHorarias[]" placeholder="Carga hor√°ria (horas)" min="1" required>
                <select name="tiposDisciplina[]" required>
                    <option value="Te√≥rica">Te√≥rica</option>
                    <option value="Pr√°tica">Pr√°tica</option>
                    <option value="Te√≥rico-Pr√°tica">Te√≥rico-Pr√°tica</option>
                </select>
                <button type="button" class="remove-disciplina" onclick="removerDisciplina(this)">√ó</button>
            `;
            container.appendChild(newDisciplina);
        }

        function removerDisciplina(button) {
            const disciplinaItem = button.parentElement;
            if (document.querySelectorAll('.disciplina-item').length > 1) {
                disciplinaItem.remove();
            } else {
                alert('O curso deve ter pelo menos uma disciplina!');
            }
        }

        function fecharModalEstudante() {
            document.getElementById('modalEstudante').style.display = 'none';
        }

        class SecretariaSystem {
            constructor() {
                this.currentUser = null;
                this.init();
            }

            init() {
                this.checkAuth();
                this.setupEventListeners();
                this.loadDashboardData();
                this.carregarCursosParaSelect();
                this.carregarTurmasParaSelect();
            }

            checkAuth() {
                const savedUser = localStorage.getItem('ipmc_currentUser');
                if (!savedUser) {
                    window.location.href = 'index.html';
                    return;
                }

                this.currentUser = JSON.parse(savedUser);
                if (this.currentUser.profile !== 'secretaria') {
                    window.location.href = 'index.html';
                    return;
                }

                document.getElementById('userWelcome').textContent = 
                    `Bem-vindo(a), ${this.currentUser.personalInfo?.nome || 'Secretaria'}`;
            }

            setupEventListeners() {
                // Navega√ß√£o
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        this.showSection(link.dataset.section);
                    });
                });

                // Formul√°rios
                const formCurso = document.getElementById('formCurso');
                if (formCurso) {
                    formCurso.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.criarCurso();
                    });
                }

                const formTurma = document.getElementById('formTurma');
                if (formTurma) {
                    formTurma.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.criarTurma();
                    });
                }

                const formEstudante = document.getElementById('formEstudante');
                if (formEstudante) {
                    formEstudante.addEventListener('submit', (e) => {
                        e.preventDefault();
                        this.matricularEstudante();
                    });
                }
            }

            showSection(sectionId) {
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });

                document.getElementById(sectionId).classList.add('active');
                document.querySelector(`[data-section="${sectionId}"]`).classList.add('active');

                // Carregar dados espec√≠ficos da se√ß√£o
                if (sectionId === 'gerenciar-cursos') {
                    this.loadCursos();
                } else if (sectionId === 'gerenciar-turmas') {
                    this.loadTurmas();
                } else if (sectionId === 'gestao-estudantes') {
                    this.loadEstudantes();
                }
            }

            loadDashboardData() {
                const cursos = this.getCursos();
                const turmas = this.getTurmas();
                const estudantes = this.getEstudantes();

                // Estat√≠sticas
                document.getElementById('cursosAtivos').textContent = cursos.length;
                document.getElementById('turmasCriadas').textContent = turmas.length;
                document.getElementById('turmasPendentes').textContent = 
                    turmas.filter(t => t.status === 'pendente').length;
                document.getElementById('estudantesMatriculados').textContent = estudantes.length;

                // Turmas aguardando valida√ß√£o
                this.loadTurmasAguardandoValidacao();
                
                // √öltimas matr√≠culas
                this.loadUltimasMatriculas();
            }

            loadTurmasAguardandoValidacao() {
                const turmasPendentes = this.getTurmas().filter(t => t.status === 'pendente');
                const container = document.getElementById('turmasAguardandoValidacao');
                
                if (turmasPendentes.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhuma turma aguardando valida√ß√£o</p>';
                    return;
                }

                container.innerHTML = turmasPendentes.map(turma => `
                    <div class="activity-item">
                        <div class="activity-info">
                            <h4>${turma.nome}</h4>
                            <p>Curso: ${this.getCursoNome(turma.cursoId)} | Sala: ${turma.sala}</p>
                            <p>Per√≠odo: ${turma.periodo} | Vagas: ${turma.vagas}</p>
                            <p>Criada em: ${this.formatDate(turma.createdAt)}</p>
                        </div>
                        <div class="activity-status">
                            <span class="status-badge pendente">Aguardando Valida√ß√£o</span>
                        </div>
                    </div>
                `).join('');
            }

            loadUltimasMatriculas() {
                const estudantes = this.getEstudantes().slice(-5).reverse();
                const container = document.getElementById('ultimasMatriculas');
                
                if (estudantes.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhuma matr√≠cula recente</p>';
                    return;
                }

                container.innerHTML = estudantes.map(estudante => {
                    const user = this.getUserById(estudante.userId);
                    const turma = this.getTurmaById(estudante.turmaId);
                    return `
                        <div class="activity-item">
                            <div class="activity-info">
                                <h4>${user.personalInfo.nome}</h4>
                                <p>Matr√≠cula: ${estudante.matricula} | Turma: ${turma.nome}</p>
                                <p>Data: ${this.formatDate(estudante.dataMatricula)}</p>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            criarCurso() {
                const form = document.getElementById('formCurso');
                const formData = new FormData(form);
                
                // Coletar disciplinas
                const disciplinas = [];
                const disciplinasInputs = form.querySelectorAll('input[name="disciplinas[]"]');
                const cargasHorarias = form.querySelectorAll('input[name="cargasHorarias[]"]');
                const tiposDisciplina = form.querySelectorAll('select[name="tiposDisciplina[]"]');
                
                for (let i = 0; i < disciplinasInputs.length; i++) {
                    if (disciplinasInputs[i].value && cargasHorarias[i].value) {
                        disciplinas.push({
                            nome: disciplinasInputs[i].value,
                            cargaHoraria: parseInt(cargasHorarias[i].value),
                            tipo: tiposDisciplina[i].value
                        });
                    }
                }

                const cursoData = {
                    nome: formData.get('nome'),
                    codigo: formData.get('codigo'),
                    duracao: parseInt(formData.get('duracao')),
                    area: formData.get('area'),
                    tipo: formData.get('tipo'),
                    descricao: formData.get('descricao'),
                    requisitos: formData.get('requisitos'),
                    preco: formData.get('preco') ? parseInt(formData.get('preco')) : null,
                    vagasTotais: formData.get('vagasTotais') ? parseInt(formData.get('vagasTotais')) : null,
                    disciplinas: disciplinas,
                    criadoPor: this.currentUser.id,
                    status: 'ativo'
                };

                // Verificar se c√≥digo j√° existe
                const cursos = this.getCursos();
                if (cursos.some(c => c.codigo === cursoData.codigo)) {
                    alert('C√≥digo do curso j√° existe! Escolha outro.');
                    return;
                }

                try {
                    const newCourse = this.addCurso(cursoData);
                    alert('Curso criado com sucesso!');
                    form.reset();
                    
                    // Limpar disciplinas
                    const disciplinasContainer = document.getElementById('disciplinasContainer');
                    disciplinasContainer.innerHTML = `
                        <div class="disciplina-item">
                            <input type="text" name="disciplinas[]" placeholder="Nome da disciplina" required>
                            <input type="number" name="cargasHorarias[]" placeholder="Carga hor√°ria (horas)" min="1" required>
                            <select name="tiposDisciplina[]" required>
                                <option value="Te√≥rica">Te√≥rica</option>
                                <option value="Pr√°tica">Pr√°tica</option>
                                <option value="Te√≥rico-Pr√°tica">Te√≥rico-Pr√°tica</option>
                            </select>
                            <button type="button" class="remove-disciplina" onclick="removerDisciplina(this)">√ó</button>
                        </div>
                    `;
                    
                    this.loadDashboardData();
                    this.carregarCursosParaSelect();
                    
                } catch (error) {
                    alert('Erro ao criar curso: ' + error.message);
                }
            }

            carregarCursosParaSelect() {
                const cursos = this.getCursos();
                const selectTurma = document.getElementById('turmaCurso');
                const selectFiltro = document.getElementById('filtroCurso');
                
                selectTurma.innerHTML = '<option value="">Selecione o curso</option>' +
                    cursos.map(curso => `
                        <option value="${curso.id}">${curso.nome} (${curso.codigo})</option>
                    `).join('');

                selectFiltro.innerHTML = '<option value="todos">Todos os Cursos</option>' +
                    cursos.map(curso => `
                        <option value="${curso.id}">${curso.nome}</option>
                    `).join('');
            }

            carregarTurmasParaSelect() {
                const turmasValidadas = this.getTurmas().filter(t => t.status === 'validada');
                const select = document.getElementById('estudanteTurma');
                
                select.innerHTML = '<option value="">Selecione a turma</option>' +
                    turmasValidadas.map(turma => `
                        <option value="${turma.id}">${turma.nome} - ${this.getCursoNome(turma.cursoId)}</option>
                    `).join('');
            }

            criarTurma() {
                const form = document.getElementById('formTurma');
                const formData = new FormData(form);
                
                const turmaData = {
                    nome: formData.get('nome'),
                    cursoId: parseInt(formData.get('cursoId')),
                    sala: formData.get('sala'),
                    periodo: formData.get('periodo'),
                    vagas: parseInt(formData.get('vagas')),
                    anoLetivo: parseInt(formData.get('anoLetivo')),
                    dataInicio: formData.get('dataInicio'),
                    dataFim: formData.get('dataFim'),
                    turno: formData.get('turno'),
                    observacoes: formData.get('observacoes'),
                    status: 'pendente', // Aguardando valida√ß√£o do pedag√≥gico
                    criadoPor: this.currentUser.id
                };

                // Verificar datas
                if (new Date(turmaData.dataInicio) >= new Date(turmaData.dataFim)) {
                    alert('A data de in√≠cio deve ser anterior √† data de t√©rmino!');
                    return;
                }

                // Verificar se nome da turma j√° existe
                const turmas = this.getTurmas();
                if (turmas.some(t => t.nome === turmaData.nome)) {
                    alert('Nome da turma j√° existe! Escolha outro.');
                    return;
                }

                try {
                    const newTurma = this.addTurma(turmaData);
                    alert('Turma criada com sucesso! Aguardando valida√ß√£o do pedag√≥gico.');
                    form.reset();
                    this.loadDashboardData();
                    
                } catch (error) {
                    alert('Erro ao criar turma: ' + error.message);
                }
            }

            matricularEstudante() {
                const form = document.getElementById('formEstudante');
                const formData = new FormData(form);
                
                const estudanteData = {
                    username: formData.get('username'),
                    password: formData.get('password'),
                    profile: 'estudante',
                    personalInfo: {
                        nome: formData.get('nome'),
                        dataNascimento: formData.get('dataNascimento'),
                        genero: formData.get('genero'),
                        bilheteIdentidade: formData.get('bilheteIdentidade'),
                        contacto: formData.get('contacto'),
                        email: formData.get('email'),
                        residencia: formData.get('residencia'),
                        encarregadoEducacao: formData.get('encarregadoEducacao'),
                        contactoEncarregado: formData.get('contactoEncarregado')
                    },
                    turmaId: parseInt(formData.get('turmaId')),
                    matricula: this.gerarNumeroMatricula(),
                    dataMatricula: new Date().toISOString(),
                    observacoes: formData.get('observacoes'),
                    status: 'ativo'
                };

                if (this.getUserByUsername(estudanteData.username)) {
                    alert('Username j√° existe! Escolha outro.');
                    return;
                }

                // Verificar se h√° vagas na turma
                const turma = this.getTurmas().find(t => t.id === estudanteData.turmaId);
                const estudantesNaTurma = this.getEstudantes().filter(e => e.turmaId === estudanteData.turmaId).length;
                
                if (estudantesNaTurma >= turma.vagas) {
                    alert('N√£o h√° vagas dispon√≠veis nesta turma!');
                    return;
                }

                try {
                    // Criar usu√°rio
                    const novoUser = this.addUser({
                        username: estudanteData.username,
                        password: estudanteData.password,
                        profile: 'estudante',
                        personalInfo: estudanteData.personalInfo,
                        status: 'ativo'
                    });

                    // Matricular estudante
                    const novoEstudante = this.addEstudante({
                        userId: novoUser.id,
                        turmaId: estudanteData.turmaId,
                        matricula: estudanteData.matricula,
                        dataMatricula: estudanteData.dataMatricula,
                        observacoes: estudanteData.observacoes,
                        status: 'ativo'
                    });

                    alert(`Estudante matriculado com sucesso! N√∫mero de matr√≠cula: ${estudanteData.matricula}`);
                    form.reset();
                    this.loadDashboardData();
                    
                } catch (error) {
                    alert('Erro ao matricular estudante: ' + error.message);
                }
            }

            loadCursos() {
                const cursos = this.getCursos();
                const container = document.getElementById('cursosList');
                
                if (cursos.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhum curso criado</p>';
                    return;
                }

                container.innerHTML = cursos.map(curso => `
                    <div class="curso-card">
                        <div class="curso-header">
                            <h3>${curso.nome}</h3>
                            <span class="curso-codigo">${curso.codigo}</span>
                        </div>
                        <div class="curso-info">
                            <p><strong>Dura√ß√£o:</strong> ${curso.duracao} meses</p>
                            <p><strong>√Årea:</strong> ${curso.area}</p>
                            <p><strong>Tipo:</strong> ${curso.tipo}</p>
                            <p><strong>Pre√ßo:</strong> ${curso.preco ? curso.preco + ' KZ' : 'N√£o definido'}</p>
                            <p><strong>Disciplinas:</strong> ${curso.disciplinas.length}</p>
                            <p><strong>Status:</strong> ${curso.status === 'ativo' ? 'Ativo' : 'Inativo'}</p>
                        </div>
                        <div class="curso-disciplinas">
                            <h4>Disciplinas:</h4>
                            <ul>
                                ${curso.disciplinas.map(disciplina => `
                                    <li>${disciplina.nome} (${disciplina.cargaHoraria}h - ${disciplina.tipo})</li>
                                `).join('')}
                            </ul>
                        </div>
                        <div class="curso-actions">
                            <button onclick="secretariaSystem.editarCurso(${curso.id})" class="action-btn primary">Editar</button>
                            <button onclick="secretariaSystem.verDetalhesCurso(${curso.id})" class="action-btn success">Detalhes</button>
                            <button onclick="secretariaSystem.alterarStatusCurso(${curso.id})" class="action-btn ${curso.status === 'ativo' ? 'warning' : 'success'}">
                                ${curso.status === 'ativo' ? 'Desativar' : 'Ativar'}
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            loadTurmas() {
                const turmas = this.getTurmas();
                const container = document.getElementById('turmasList');
                
                if (turmas.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhuma turma criada</p>';
                    return;
                }

                container.innerHTML = turmas.map(turma => `
                    <div class="turma-card ${turma.status}">
                        <div class="turma-header">
                            <h3>${turma.nome}</h3>
                            <span class="status-badge ${turma.status}">${this.getStatusText(turma.status)}</span>
                        </div>
                        <div class="turma-info">
                            <p><strong>Curso:</strong> ${this.getCursoNome(turma.cursoId)}</p>
                            <p><strong>Sala:</strong> ${turma.sala}</p>
                            <p><strong>Per√≠odo:</strong> ${turma.periodo}</p>
                            <p><strong>Vagas:</strong> ${turma.vagas}</p>
                            <p><strong>Ano Letivo:</strong> ${turma.anoLetivo}</p>
                            <p><strong>Per√≠odo:</strong> ${this.formatDate(turma.dataInicio)} a ${this.formatDate(turma.dataFim)}</p>
                            <p><strong>Estudantes:</strong> ${this.getNumeroEstudantesTurma(turma.id)}/${turma.vagas}</p>
                        </div>
                        <div class="turma-actions">
                            ${turma.status === 'pendente' ? `
                                <span class="status-info">Aguardando valida√ß√£o</span>
                            ` : turma.status === 'validada' ? `
                                <span class="status-info success">‚úÖ Validada</span>
                                ${turma.tutorId ? `
                                    <span class="tutor-info">Tutor: ${this.getUserName(turma.tutorId)}</span>
                                ` : '<span class="status-info">Sem tutor atribu√≠do</span>'}
                            ` : `
                                <span class="status-info danger">‚ùå Recusada</span>
                                ${turma.observacoesValidacao ? `<p><strong>Motivo:</strong> ${turma.observacoesValidacao}</p>` : ''}
                            `}
                            <button onclick="secretariaSystem.verDetalhesTurma(${turma.id})" class="action-btn primary">Detalhes</button>
                        </div>
                    </div>
                `).join('');
            }

            loadEstudantes() {
                const estudantes = this.getEstudantes();
                const container = document.getElementById('estudantesList');
                
                if (estudantes.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhum estudante matriculado</p>';
                    return;
                }

                container.innerHTML = estudantes.map(estudante => {
                    const user = this.getUserById(estudante.userId);
                    const turma = this.getTurmaById(estudante.turmaId);
                    return `
                        <div class="turma-card">
                            <div class="turma-header">
                                <h3>${user.personalInfo.nome}</h3>
                                <span class="curso-codigo">${estudante.matricula}</span>
                            </div>
                            <div class="turma-info">
                                <p><strong>Turma:</strong> ${turma.nome}</p>
                                <p><strong>Curso:</strong> ${this.getCursoNome(turma.cursoId)}</p>
                                <p><strong>Contacto:</strong> ${user.personalInfo.contacto}</p>
                                <p><strong>Email:</strong> ${user.personalInfo.email}</p>
                                <p><strong>Data de Matr√≠cula:</strong> ${this.formatDate(estudante.dataMatricula)}</p>
                                <p><strong>Status:</strong> ${estudante.status === 'ativo' ? 'Ativo' : 'Inativo'}</p>
                            </div>
                            <div class="turma-actions">
                                <button onclick="secretariaSystem.verDetalhesEstudante(${estudante.id})" class="action-btn primary">Detalhes</button>
                                <button onclick="secretariaSystem.editarEstudante(${estudante.id})" class="action-btn success">Editar</button>
                                <button onclick="secretariaSystem.alterarStatusEstudante(${estudante.id})" class="action-btn ${estudante.status === 'ativo' ? 'warning' : 'success'}">
                                    ${estudante.status === 'ativo' ? 'Desativar' : 'Ativar'}
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            filtrarCursos() {
                const searchTerm = document.getElementById('searchCursos').value.toLowerCase();
                const cursos = this.getCursos();
                const cursosFiltrados = cursos.filter(curso => 
                    curso.nome.toLowerCase().includes(searchTerm) ||
                    curso.codigo.toLowerCase().includes(searchTerm) ||
                    curso.area.toLowerCase().includes(searchTerm)
                );
                
                const container = document.getElementById('cursosList');
                if (cursosFiltrados.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhum curso encontrado</p>';
                    return;
                }

                container.innerHTML = cursosFiltrados.map(curso => `
                    <div class="curso-card">
                        <div class="curso-header">
                            <h3>${curso.nome}</h3>
                            <span class="curso-codigo">${curso.codigo}</span>
                        </div>
                        <div class="curso-info">
                            <p><strong>Dura√ß√£o:</strong> ${curso.duracao} meses</p>
                            <p><strong>√Årea:</strong> ${curso.area}</p>
                            <p><strong>Tipo:</strong> ${curso.tipo}</p>
                            <p><strong>Disciplinas:</strong> ${curso.disciplinas.length}</p>
                        </div>
                        <div class="curso-actions">
                            <button onclick="secretariaSystem.editarCurso(${curso.id})" class="action-btn primary">Editar</button>
                            <button onclick="secretariaSystem.verDetalhesCurso(${curso.id})" class="action-btn success">Detalhes</button>
                        </div>
                    </div>
                `).join('');
            }

            filtrarTurmas() {
                const filtroStatus = document.getElementById('filtroStatus').value;
                const filtroCurso = document.getElementById('filtroCurso').value;
                const turmas = this.getTurmas();
                
                let turmasFiltradas = turmas;
                if (filtroStatus !== 'todas') {
                    turmasFiltradas = turmasFiltradas.filter(t => t.status === filtroStatus);
                }
                if (filtroCurso !== 'todos') {
                    turmasFiltradas = turmasFiltradas.filter(t => t.cursoId === parseInt(filtroCurso));
                }
                
                const container = document.getElementById('turmasList');
                if (turmasFiltradas.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhuma turma encontrada</p>';
                    return;
                }

                container.innerHTML = turmasFiltradas.map(turma => `
                    <div class="turma-card ${turma.status}">
                        <div class="turma-header">
                            <h3>${turma.nome}</h3>
                            <span class="status-badge ${turma.status}">${this.getStatusText(turma.status)}</span>
                        </div>
                        <div class="turma-info">
                            <p><strong>Curso:</strong> ${this.getCursoNome(turma.cursoId)}</p>
                            <p><strong>Sala:</strong> ${turma.sala}</p>
                            <p><strong>Per√≠odo:</strong> ${turma.periodo}</p>
                            <p><strong>Vagas:</strong> ${turma.vagas}</p>
                            <p><strong>Estudantes:</strong> ${this.getNumeroEstudantesTurma(turma.id)}/${turma.vagas}</p>
                        </div>
                        <div class="turma-actions">
                            <button onclick="secretariaSystem.verDetalhesTurma(${turma.id})" class="action-btn primary">Detalhes</button>
                        </div>
                    </div>
                `).join('');
            }

            filtrarEstudantes() {
                const searchTerm = document.getElementById('searchEstudantes').value.toLowerCase();
                const estudantes = this.getEstudantes();
                const estudantesFiltrados = estudantes.filter(estudante => {
                    const user = this.getUserById(estudante.userId);
                    return user.personalInfo.nome.toLowerCase().includes(searchTerm) ||
                           estudante.matricula.toLowerCase().includes(searchTerm);
                });
                
                const container = document.getElementById('estudantesList');
                if (estudantesFiltrados.length === 0) {
                    container.innerHTML = '<p class="no-data">Nenhum estudante encontrado</p>';
                    return;
                }

                container.innerHTML = estudantesFiltrados.map(estudante => {
                    const user = this.getUserById(estudante.userId);
                    const turma = this.getTurmaById(estudante.turmaId);
                    return `
                        <div class="turma-card">
                            <div class="turma-header">
                                <h3>${user.personalInfo.nome}</h3>
                                <span class="curso-codigo">${estudante.matricula}</span>
                            </div>
                            <div class="turma-info">
                                <p><strong>Turma:</strong> ${turma.nome}</p>
                                <p><strong>Curso:</strong> ${this.getCursoNome(turma.cursoId)}</p>
                                <p><strong>Contacto:</strong> ${user.personalInfo.contacto}</p>
                                <p><strong>Data de Matr√≠cula:</strong> ${this.formatDate(estudante.dataMatricula)}</p>
                            </div>
                            <div class="turma-actions">
                                <button onclick="secretariaSystem.verDetalhesEstudante(${estudante.id})" class="action-btn primary">Detalhes</button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            // Novas funcionalidades extras
            gerarRelatorioRapido() {
                const cursos = this.getCursos().length;
                const turmas = this.getTurmas().length;
                const estudantes = this.getEstudantes().length;
                const turmasPendentes = this.getTurmas().filter(t => t.status === 'pendente').length;

                const relatorio = `
RELAT√ìRIO R√ÅPIDO - ${new Date().toLocaleDateString('pt-PT')}

üìä ESTAT√çSTICAS GERAIS:
‚Ä¢ Cursos Activos: ${cursos}
‚Ä¢ Turmas Criadas: ${turmas}
‚Ä¢ Turmas Pendentes: ${turmasPendentes}
‚Ä¢ Estudantes Matriculados: ${estudantes}

üìà RESUMO:
‚Ä¢ Taxa de Ocupa√ß√£o: ${((estudantes / (turmas * 30)) * 100).toFixed(1)}% (base estimada)
‚Ä¢ Cursos com Mais Turmas: ${this.getCursoComMaisTurmas()}
‚Ä¢ Turma com Mais Estudantes: ${this.getTurmaComMaisEstudantes()}
                `;

                alert(relatorio);
            }

            getCursoComMaisTurmas() {
                const turmas = this.getTurmas();
                const cursoCount = {};
                turmas.forEach(turma => {
                    cursoCount[turma.cursoId] = (cursoCount[turma.cursoId] || 0) + 1;
                });
                
                const maxCursoId = Object.keys(cursoCount).reduce((a, b) => 
                    cursoCount[a] > cursoCount[b] ? a : b
                );
                
                return this.getCursoNome(parseInt(maxCursoId));
            }

            getTurmaComMaisEstudantes() {
                const turmas = this.getTurmas();
                let maxTurma = null;
                let maxEstudantes = 0;

                turmas.forEach(turma => {
                    const numEstudantes = this.getNumeroEstudantesTurma(turma.id);
                    if (numEstudantes > maxEstudantes) {
                        maxEstudantes = numEstudantes;
                        maxTurma = turma;
                    }
                });

                return maxTurma ? `${maxTurma.nome} (${maxEstudantes} estudantes)` : 'Nenhuma';
            }

            exportarCursos() {
                const cursos = this.getCursos();
                const csv = this.convertToCSV(cursos.map(curso => ({
                    'C√≥digo': curso.codigo,
                    'Nome': curso.nome,
                    '√Årea': curso.area,
                    'Tipo': curso.tipo,
                    'Dura√ß√£o (meses)': curso.duracao,
                    'Pre√ßo': curso.preco || 'N√£o definido',
                    'Disciplinas': curso.disciplinas.length,
                    'Status': curso.status
                })));

                this.downloadCSV(csv, 'cursos_ipmc.csv');
            }

            exportarTurmas() {
                const turmas = this.getTurmas();
                const csv = this.convertToCSV(turmas.map(turma => ({
                    'Nome': turma.nome,
                    'Curso': this.getCursoNome(turma.cursoId),
                    'Sala': turma.sala,
                    'Per√≠odo': turma.periodo,
                    'Vagas': turma.vagas,
                    'Estudantes': this.getNumeroEstudantesTurma(turma.id),
                    'Ano Letivo': turma.anoLetivo,
                    'Status': this.getStatusText(turma.status),
                    'Data In√≠cio': this.formatDate(turma.dataInicio),
                    'Data Fim': this.formatDate(turma.dataFim)
                })));

                this.downloadCSV(csv, 'turmas_ipmc.csv');
            }

            exportarEstudantes() {
                const estudantes = this.getEstudantes();
                const csv = this.convertToCSV(estudantes.map(estudante => {
                    const user = this.getUserById(estudante.userId);
                    const turma = this.getTurmaById(estudante.turmaId);
                    return {
                        'Matr√≠cula': estudante.matricula,
                        'Nome': user.personalInfo.nome,
                        'Bilhete': user.personalInfo.bilheteIdentidade,
                        'Contacto': user.personalInfo.contacto,
                        'Email': user.personalInfo.email,
                        'Turma': turma.nome,
                        'Curso': this.getCursoNome(turma.cursoId),
                        'Data Matr√≠cula': this.formatDate(estudante.dataMatricula),
                        'Status': estudante.status
                    };
                }));

                this.downloadCSV(csv, 'estudantes_ipmc.csv');
            }

            convertToCSV(data) {
                const headers = Object.keys(data[0]);
                const csv = [
                    headers.join(','),
                    ...data.map(row => headers.map(header => `"${row[header]}"`).join(','))
                ].join('\n');
                return csv;
            }

            downloadCSV(csv, filename) {
                const blob = new Blob([csv], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                window.URL.revokeObjectURL(url);
            }

            verDetalhesEstudante(estudanteId) {
                const estudante = this.getEstudantes().find(e => e.id === estudanteId);
                const user = this.getUserById(estudante.userId);
                const turma = this.getTurmaById(estudante.turmaId);
                const curso = this.getCursos().find(c => c.id === turma.cursoId);

                const detalhes = `
                    <div class="turma-info">
                        <h4>${user.personalInfo.nome}</h4>
                        <p><strong>Matr√≠cula:</strong> ${estudante.matricula}</p>
                        <p><strong>Bilhete de Identidade:</strong> ${user.personalInfo.bilheteIdentidade}</p>
                        <p><strong>Data de Nascimento:</strong> ${this.formatDate(user.personalInfo.dataNascimento)}</p>
                        <p><strong>G√™nero:</strong> ${user.personalInfo.genero}</p>
                        <p><strong>Contacto:</strong> ${user.personalInfo.contacto}</p>
                        <p><strong>Email:</strong> ${user.personalInfo.email}</p>
                        <p><strong>Resid√™ncia:</strong> ${user.personalInfo.residencia}</p>
                        <p><strong>Encarregado de Educa√ß√£o:</strong> ${user.personalInfo.encarregadoEducacao || 'N/A'}</p>
                        <p><strong>Contacto do Encarregado:</strong> ${user.personalInfo.contactoEncarregado || 'N/A'}</p>
                        <hr>
                        <p><strong>Turma:</strong> ${turma.nome}</p>
                        <p><strong>Curso:</strong> ${curso.nome}</p>
                        <p><strong>Sala:</strong> ${turma.sala}</p>
                        <p><strong>Per√≠odo:</strong> ${turma.periodo}</p>
                        <p><strong>Data de Matr√≠cula:</strong> ${this.formatDate(estudante.dataMatricula)}</p>
                        ${estudante.observacoes ? `<p><strong>Observa√ß√µes:</strong> ${estudante.observacoes}</p>` : ''}
                    </div>
                `;

                document.getElementById('detalhesEstudante').innerHTML = detalhes;
                document.getElementById('modalEstudante').style.display = 'block';
            }

            verDetalhesCurso(cursoId) {
                const curso = this.getCursos().find(c => c.id === cursoId);
                const turmas = this.getTurmas().filter(t => t.cursoId === cursoId);
                
                alert(`
DETALHES DO CURSO: ${curso.nome}

C√≥digo: ${curso.codigo}
√Årea: ${curso.area}
Tipo: ${curso.tipo}
Dura√ß√£o: ${curso.duracao} meses
Pre√ßo: ${curso.preco ? curso.preco + ' KZ' : 'N√£o definido'}
Vagas Totais: ${curso.vagasTotais || 'N√£o definido'}

DESCRI√á√ÉO:
${curso.descricao || 'Nenhuma descri√ß√£o'}

REQUISITOS:
${curso.requisitos || 'Nenhum requisito espec√≠fico'}

DISCIPLINAS (${curso.disciplinas.length}):
${curso.disciplinas.map(d => `‚Ä¢ ${d.nome} (${d.cargaHoraria}h - ${d.tipo})`).join('\n')}

TURMAS (${turmas.length}):
${turmas.map(t => `‚Ä¢ ${t.nome} - ${t.status}`).join('\n')}
                `);
            }

            verDetalhesTurma(turmaId) {
                const turma = this.getTurmas().find(t => t.id === turmaId);
                const curso = this.getCursos().find(c => c.id === turma.cursoId);
                const estudantes = this.getEstudantes().filter(e => e.turmaId === turmaId);
                const tutor = turma.tutorId ? this.getUserById(turma.tutorId) : null;

                alert(`
DETALHES DA TURMA: ${turma.nome}

Curso: ${curso.nome}
Sala: ${turma.sala}
Per√≠odo: ${turma.periodo}
Turno: ${turma.turno}
Vagas: ${turma.vagas}
Estudantes Matriculados: ${estudantes.length}
Ano Letivo: ${turma.anoLetivo}
Per√≠odo: ${this.formatDate(turma.dataInicio)} a ${this.formatDate(turma.dataFim)}
Status: ${this.getStatusText(turma.status)}

${tutor ? `Tutor: ${tutor.personalInfo.nome}` : 'Tutor: N√£o atribu√≠do'}

OBSERVA√á√ïES:
${turma.observacoes || 'Nenhuma observa√ß√£o'}

${turma.observacoesValidacao ? `OBSERVA√á√ïES DA VALIDA√á√ÉO:\n${turma.observacoesValidacao}` : ''}
                `);
            }

            // M√©todos auxiliares
            gerarNumeroMatricula() {
                const ano = new Date().getFullYear();
                const random = Math.floor(Math.random() * 10000).toString().padStart(4, '0');
                return `${ano}${random}`;
            }

            getCursoNome(cursoId) {
                const cursos = this.getCursos();
                const curso = cursos.find(c => c.id === cursoId);
                return curso ? curso.nome : 'Curso n√£o encontrado';
            }

            getUserName(userId) {
                const users = this.getUsers();
                const user = users.find(u => u.id === userId);
                return user ? user.personalInfo?.nome : 'Usu√°rio n√£o encontrado';
            }

            getStatusText(status) {
                const statusMap = {
                    'pendente': 'Pendente',
                    'validada': 'Validada',
                    'recusada': 'Recusada'
                };
                return statusMap[status] || status;
            }

            getNumeroEstudantesTurma(turmaId) {
                const estudantes = this.getEstudantes();
                return estudantes.filter(e => e.turmaId === turmaId).length;
            }

            getTurmaById(turmaId) {
                const turmas = this.getTurmas();
                return turmas.find(t => t.id === turmaId);
            }

            formatDate(dateString) {
                if (!dateString) return 'N/A';
                return new Date(dateString).toLocaleDateString('pt-PT');
            }

            // M√©todos do banco de dados
            getUsers() {
                return JSON.parse(localStorage.getItem('ipmc_users') || '[]');
            }

            saveUsers(users) {
                localStorage.setItem('ipmc_users', JSON.stringify(users));
            }

            getUserByUsername(username) {
                const users = this.getUsers();
                return users.find(u => u.username === username);
            }

            getUserById(userId) {
                const users = this.getUsers();
                return users.find(u => u.id === userId);
            }

            addUser(userData) {
                const users = this.getUsers();
                const newUser = {
                    id: this.generateId(users),
                    ...userData,
                    createdAt: new Date().toISOString()
                };
                users.push(newUser);
                this.saveUsers(users);
                return newUser;
            }

            getCursos() {
                return JSON.parse(localStorage.getItem('ipmc_cursos') || '[]');
            }

            saveCursos(cursos) {
                localStorage.setItem('ipmc_cursos', JSON.stringify(cursos));
            }

            addCurso(cursoData) {
                const cursos = this.getCursos();
                const newCurso = {
                    id: this.generateId(cursos),
                    ...cursoData,
                    createdAt: new Date().toISOString()
                };
                cursos.push(newCurso);
                this.saveCursos(cursos);
                return newCurso;
            }

            getTurmas() {
                return JSON.parse(localStorage.getItem('ipmc_turmas') || '[]');
            }

            saveTurmas(turmas) {
                localStorage.setItem('ipmc_turmas', JSON.stringify(turmas));
            }

            addTurma(turmaData) {
                const turmas = this.getTurmas();
                const newTurma = {
                    id: this.generateId(turmas),
                    ...turmaData,
                    createdAt: new Date().toISOString()
                };
                turmas.push(newTurma);
                this.saveTurmas(turmas);
                return newTurma;
            }

            getEstudantes() {
                return JSON.parse(localStorage.getItem('ipmc_estudantes') || '[]');
            }

            saveEstudantes(estudantes) {
                localStorage.setItem('ipmc_estudantes', JSON.stringify(estudantes));
            }

            addEstudante(estudanteData) {
                const estudantes = this.getEstudantes();
                const newEstudante = {
                    id: this.generateId(estudantes),
                    ...estudanteData,
                    createdAt: new Date().toISOString()
                };
                estudantes.push(newEstudante);
                this.saveEstudantes(estudantes);
                return newEstudante;
            }

            generateId(collection) {
                return collection.length > 0 ? Math.max(...collection.map(item => item.id)) + 1 : 1;
            }

            // M√©todos para relat√≥rios
            gerarRelatorioCursos() {
                alert('Relat√≥rio de cursos gerado com sucesso!');
            }

            gerarRelatorioTurmas() {
                alert('Relat√≥rio de turmas gerado com sucesso!');
            }

            gerarRelatorioEstudantes() {
                alert('Relat√≥rio de estudantes gerado com sucesso!');
            }

            gerarRelatorioMatriculas() {
                alert('Relat√≥rio de matr√≠culas gerado com sucesso!');
            }

            editarCurso(cursoId) {
                alert(`Editar curso ID: ${cursoId}`);
            }

            alterarStatusCurso(cursoId) {
                const cursos = this.getCursos();
                const curso = cursos.find(c => c.id === cursoId);
                if (curso) {
                    curso.status = curso.status === 'ativo' ? 'inativo' : 'ativo';
                    this.saveCursos(cursos);
                    this.loadCursos();
                    alert(`Curso ${curso.status === 'ativo' ? 'ativado' : 'desativado'} com sucesso!`);
                }
            }

            editarEstudante(estudanteId) {
                alert(`Editar estudante ID: ${estudanteId}`);
            }

            alterarStatusEstudante(estudanteId) {
                const estudantes = this.getEstudantes();
                const estudante = estudantes.find(e => e.id === estudanteId);
                if (estudante) {
                    estudante.status = estudante.status === 'ativo' ? 'inativo' : 'ativo';
                    this.saveEstudantes(estudantes);
                    this.loadEstudantes();
                    alert(`Estudante ${estudante.status === 'ativo' ? 'ativado' : 'desativado'} com sucesso!`);
                }
            }
        }

        // Fun√ß√£o global para logout
        function logout() {
            localStorage.removeItem('ipmc_currentUser');
            window.location.href = 'index.html';
        }

        // Inicializar sistema da secretaria
        const secretariaSystem = new SecretariaSystem();
    </script>
</body>
</html>